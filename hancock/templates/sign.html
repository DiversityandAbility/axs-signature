{% extends "base.html" %}

{% block extra_head %}
  <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@latest/dist/svg.min.js"></script>
{% endblock %}

{% block body %}
<div class="p-6 my-4 border-4 rounded-lg">
<h1 class="text-center text-xl italic">Your Signature is Required</h1>
<i class="fa-thin fa-4x fa-signature block mx-auto p-4" ></i>
<div class="p-4 my-0 border-4 bg-gray-100 block rounded-lg">
<h2 class="py-2 font-bold uppercase">Document Title: Draft Agreement</h2>

<p>{{ details.declaration }}</p>
<!--            
    IF OVER CHAR LIMIT?    
    <p>
      <a href="Â£" class="text-sky-500 hover:text-sky-600">Read the full document &rarr;</a>
    </p>
-->

<h2>Sign Here</h2>




<!--
<div class="p-4 my-4 border bg-gray-100">
<p>Type in the text box below to add your signature.</p>
<form action="" method="POST" enctype="multipart/form-data">
    
    <p>For now this is a file upload.</p>
    <input type="file" name="signature" accept=".svg,image/svg+xml">
    <div class="block flex justify-center p-4">
        <input type="submit" value="Submit" class="p-8 border-4 hover:bg-white">
    </div>
    
</form>

</div>
-->
</div>
         
  <div class="mx-auto text-center">
            <div class=" my-8">
              <div class="p-4 my-4 border-4 bg-gray-100 block rounded-lg">
                <form>
                  <label class="font-bold block mb-2">Type in the textbox below to add your signature</label>
                  <input class="focus:shadow-outline appearance-none w-full rounded border py-2 px-3 leading-tight text-gray-700 shadow focus:outline-none" type="text" placeholder=" e.g. John Smith" id="name" />
                </form>
                <div id="signature" class="bg-white w-[300px] mx-auto mt-4"></div>
              </div>
            </div>
            <div> 
              <button type="submit" id="user-signature" class="text-white px-6 py-4 bg-hyperlinkcolour border-4 rounded-xl hover:bg-sky-600 shadow-sm hover:shadow-xl font-bold uppercase">submit</button>
            </div>
          </div>
</div>

<script>
  (function() {
    var input = document.querySelector('#name');
    var draw = SVG().addTo('#signature').size(300, 100);

    var text = draw.text(function(add) {
      add.tspan( input.value );
    })
    text.move(0, 40).font({ })

    var datetime = draw.text(function(add) {
      // TODO: Get this time to update, it should reflect the time the user presses submit, not the time they opened the page
      // so auto-update the date in the image. Don't update it every second, or show seconds to the user, that would make it seem like
      // there's a time pressure to sign.
      add.tspan( new Date().toISOString() );
    });
    datetime.move(0, 0).font({ "font-size": "smaller" });

    var hash = draw.text(function(add) {
      add.tspan("{{ sid }}");
    });
    hash.move(0, 80).font({ "font-size": "smaller"});

    input.addEventListener('keyup', updateText)
    function updateText() {
        text.clear();
        text.plain(input.value);
    }
  })();
</script>

{% endblock %}
