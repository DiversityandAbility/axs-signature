{% extends "base.html" %}

{% block extra_head %}
  <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@latest/dist/svg.min.js"></script>
{% endblock %}

{% block body %}
<h1 class="font-bold text-2xl md:text-xl py-4 uppercase">Hancock - Simple, Accessible, and Secure Electronic Signatures</h1>
<i class="fa-thin fa-4x fa-signature block mx-auto p-4" ></i>
<h1 class="text-center text-xl italic">Your Signature is Required</h1>
<div class="p-6 my-4 border-4 rounded-lg">


  <div class="p-4 my-0 border-4 bg-gray-100 block rounded-lg">
    <h2 class="py-2 font-bold uppercase">Document Title: Draft Agreement</h2>
    <p>{{ details.declaration }}</p>
  </div>
  <div class="mx-auto text-center">
    <div class=" my-8">
      <div class="p-4 my-4 border-4 bg-gray-100 block rounded-lg">
        <form>
          <label class="font-bold block mb-2">Type in the textbox below to add your signature</label>
          <input class="focus:shadow-outline appearance-none w-full h-14 rounded border py-2 px-3 leading-tight text-gray-700 shadow focus:outline-none" type="text" placeholder=" e.g. John Smith" id="name" />
        </form>
        <div id="signature" class="bg-white w-[80%] mx-auto mt-4 p-4"></div>
      </div>
    </div>
    <div> 
      <button type="submit" id="user-signature" class="text-white px-6 py-4 bg-hyperlinkcolour border-4 rounded-xl hover:bg-sky-600 shadow-sm hover:shadow-xl font-bold uppercase">submit</button>
    </div>
  </div>
</div>

  <script>
    (function() {
      var input = document.querySelector('#name');
      var draw = SVG().addTo('#signature').size(300, 100);

      var text = draw.text(function(add) {
        add.tspan( input.value );
      })
      text.move(0, 0).font({ })
      text.center(draw.width()/2, draw.height()*0.6);

    text.font({
      family:   'Cursive',
      size:     28, 
      anchor:   'middle',
      leading:  '1.5em'
    })

      var datetime = draw.text(function(add) {
        // TODO: Get this time to update, it should reflect the time the user presses submit, not the time they opened the page
        // so auto-update the date in the image. Don't update it every second, or show seconds to the user, that would make it seem like
        // there's a time pressure to sign.
        add.tspan( new Date().toISOString() );
      });
      datetime.move(0, 0).font({ "font-size": "smaller",
      "fill": "#484848" });

      var hash = draw.text(function(add) {
        add.tspan("{{ sid }}");
      });
      hash.move(0, 80).font({ "font-size": "smaller",
      "fill": "#484848" });
      hash.fill(50);
      input.addEventListener('keyup', updateText)
      function updateText() {
          text.clear();
          text.plain(input.value);
      }
    })();
  </script>

{% endblock %}
